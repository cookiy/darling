$.plug("ajax",function($){var xhrs=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("MSXML2.XMLHTTP.3.0")},function(){return new ActiveXObject("MSXML2.XMLHTTP")}],_xhrf=null;$.xhr=function(){if(_xhrf!=null)return _xhrf();for(var a=0,b=xhrs.length;a<b;a++)try{var c=xhrs[a],d=c();if(d!=null)return _xhrf=c,d}catch(e){}return function(){}},$._xhrResp=function(xhr,dataType){dataType=dataType||xhr.getResponseHeader("Content-Type").split(";")[0];switch(dataType){case"text/xml":return xhr.responseXML;case"json":case"text/json":case"application/json":case"text/javascript":case"application/javascript":case"application/x-javascript":return window.JSON?JSON.parse(xhr.responseText):eval(xhr.responseText);default:return xhr.responseText}},$.formData=function(a){var b=[],c=/%20/g;for(var d in a)b.push(encodeURIComponent(d).replace(c,"+")+"="+encodeURIComponent(a[d].toString()).replace(c,"+"));return b.join("&")},$.ajax=function(a){var b=$.xhr(),c,d=0;a=$._defaults(a,{userAgent:"XMLHttpRequest",lang:"en",type:"GET",data:null,contentType:"application/x-www-form-urlencoded",dataType:"application/json"}),a.timeout&&(c=setTimeout(function(){b.abort(),a.timeoutFn&&a.timeoutFn(a.url)},a.timeout)),b.onreadystatechange=function(){b.readyState==4?(c&&clearTimeout(c),b.status<300?a.success&&a.success($._xhrResp(b,a.dataType)):a.error&&a.error(b,b.status,b.statusText),a.complete&&a.complete(b,b.statusText)):a.progress&&a.progress(++d)};var e=a.url,f=null,g=a.type=="POST"||a.type=="PUT";!g&&a.data&&(e+="?"+$.formData(a.data)),b.open(a.type,e);if(g){var h=a.dataType.indexOf("json")>=0;f=h?JSON.stringify(a.data):$.formData(a.data),b.setRequestHeader("Content-Type",h?"application/json":"application/x-www-form-urlencoded")}b.send(f)},$.getJSON=function(a,b,c,d){$.isFunction(b)&&(d=c,c=b,b=null),$.ajax({url:a,dataType:"json",data:b,success:c,error:d})},$.get=function(a,b,c,d){$.isFunction(b)&&(d=c,c=b,b=null),$.ajax({url:a,type:"GET",data:b,success:c,dataType:d||"text/plain"})},$.post=function(a,b,c,d){$.isFunction(b)&&(d=c,c=b,b=null),$.ajax({url:a,type:"POST",data:b,success:c,dataType:d||"text/plain"})}})